spring:
  application:
    name: pp-gateway

  cloud:
    gateway:
      routes:
        # Room Service Routes
        - id: room-service
          uri: http://${ROOM_SERVICE_HOST:localhost}:${ROOM_SERVICE_PORT:8081}
          predicates:
            - Path=/api/v1/rooms/**, /api/v1/stories/**, /api/v1/invitations/**, /api/v1/admin/stories/**

        # Vote Service Routes
        - id: vote-service
          uri: http://${VOTE_SERVICE_HOST:localhost}:${VOTE_SERVICE_PORT:8082}
          predicates:
            - Path=/api/v1/votes/**, /api/v1/voting/**

        # Vote Service WebSocket
        - id: vote-service-ws
          uri: ws://${VOTE_SERVICE_HOST:localhost}:${VOTE_SERVICE_PORT:8082}
          predicates:
            - Path=/ws/**

        # Audit Service Routes (Admin only)
        - id: audit-service
          uri: http://${AUDIT_SERVICE_HOST:localhost}:${AUDIT_SERVICE_PORT:8083}
          predicates:
            - Path=/api/v1/admin/audit/**

        # Room Service Swagger
        - id: room-service-swagger
          uri: http://${ROOM_SERVICE_HOST:localhost}:${ROOM_SERVICE_PORT:8081}
          predicates:
            - Path=/room-service/v3/api-docs/**
          filters:
            - RewritePath=/room-service/(?<segment>.*), /${segment}

        # Vote Service Swagger
        - id: vote-service-swagger
          uri: http://${VOTE_SERVICE_HOST:localhost}:${VOTE_SERVICE_PORT:8082}
          predicates:
            - Path=/vote-service/v3/api-docs/**
          filters:
            - RewritePath=/vote-service/(?<segment>.*), /${segment}

        # Audit Service Swagger
        - id: audit-service-swagger
          uri: http://${AUDIT_SERVICE_HOST:localhost}:${AUDIT_SERVICE_PORT:8083}
          predicates:
            - Path=/audit-service/v3/api-docs/**
          filters:
            - RewritePath=/audit-service/(?<segment>.*), /${segment}

  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://${KEYCLOAK_HOST:localhost}:8180/realms/planning-poker
          jwk-set-uri: http://${KEYCLOAK_HOST:localhost}:8180/realms/planning-poker/protocol/openid-connect/certs

server:
  port: 8090

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,gateway
  endpoint:
    health:
      show-details: always
      probes:
        enabled: true
    gateway:
      enabled: true
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true

logging:
  level:
    root: INFO
    org.springframework.cloud.gateway: INFO
    org.springframework.security: INFO
